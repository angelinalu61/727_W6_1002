# install.packages("xml2")
# install.packages("rvest")
# install.packages("jsonlite")
# install.packages("robotstxt")
# install.packages("RSocrata")
library(xml2)
library(rvest)
library(jsonlite)
library(robotstxt)
library(RSocrata)
paths_allowed("https://www.niche.com/colleges/search/best-colleges/")
url <- read_html("https://www.niche.com/colleges/search/best-colleges/")
nds <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result__title", " " ))]')
nds <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result__title", " " ))]')
names <- html_text(nds)
head(names)
names <- html_text(nds)
head(names)
nds2 <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-fact-list__item", " " ))]')
stats <- html_text(nds2)
head(stats)
stats_dat <- matrix(stats, ncol = 4, byrow = T)
head(stats_dat)
stats_dat <- as.data.frame(stats_dat)
names(stats_dat) <- c("niche_grade", "acceptance_rate", "net_price", "SAT_range")
names <- html_text(nds)
head(names)
paths_allowed("https://www.niche.com/colleges/search/best-colleges/")
url <- read_html("https://www.niche.com/colleges/search/best-colleges/")
nds <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result__title", " " ))]')
names <- html_text(nds)
head(names)
names <- html_text(nds)
head(names)
nds <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result__title", " " ))]')
names <- html_text(nds)
head(names)
nds <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "nss-i5xnri", " " ))] | //*[contains(concat( " ", @class, " " ), concat( " ", "nss-1160g0z", " " ))]')
names <- html_text(nds)
head(names)
nds <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "nss-i5xnri", " " ))] | //*[contains(concat( " ", @class, " " ), concat( " ", "nss-1160g0z", " " ))]')
names <- html_text(nds)
head(names)
nds <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "nss-i5xnri", " " ))]')
names <- html_text(nds)
head(names)
nds2 <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-fact-list__item", " " ))]')
stats <- html_text(nds2)
head(stats)
location_nodes <- html_nodes(url, xpath = 'html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-fact-list__item", " " ))]')')
location_nodes <- html_nodes(url, xpath = '//*+[contains(concat( " ", @class, " " ), concat( " ", "visually-hidden", " " ))]//span | //*+[contains(concat( " ", @class, " " ), concat( " ", "nss-1syd5h", " " ))]//*[contains(concat( " ", @class, " " ), concat( " ", "nss-1omwe6m", " " ))]')
location_nodes <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "nss-i5xnri", " " ))] | //*+[contains(concat( " ", @class, " " ), concat( " ", "visually-hidden", " " ))]//span | //*+[contains(concat( " ", @class, " " ), concat( " ", "nss-1syd5h", " " ))]//*[contains(concat( " ", @class, " " ), concat( " ", "nss-1omwe6m", " " ))]')
location_nodes <- html_nodes(url, xpath = '//span | //*+[contains(concat( " ", @class, " " ), concat( " ", "nss-1syd5h", " " ))]//*[contains(concat( " ", @class, " " ), concat( " ", "nss-1omwe6m", " " ))]')
location_nodes <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-tagline__item", " " ))]')
locations <- html_text(location_nodes)
locations
stats_dat <- matrix(stats, ncol = 4, byrow = T)
head(stats_dat)
stats_dat <- as.data.frame(stats_dat)
names(stats_dat) <- c("niche_grade", "acceptance_rate", "net_price", "SAT_range")
nds2 <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-fact-list__item", " " ))]')
stats <- html_text(nds2)
head(stats)
stats_dat <- as.data.frame(stats_dat)
names(stats_dat) <- c("niche_grade", "acceptance_rate", "net_price", "SAT_range")
stats_dat$niche_grade <- gsub("Overall Niche Grade", "", stats_dat$niche_grade)
stats_dat$acceptance_rate <- as.numeric(gsub("[^0123456789,]", "", stats_dat$acceptance_rate))
stats_dat$net_price <- as.numeric(gsub("[^0123456789]", "", stats_dat$net_price))
stats_dat$SAT_range <- gsub("SAT Range", "", stats_dat$SAT_range)
head(stats_dat)
glimspe(stats_dat)
glimpse(stats_dat)
top_colleges <- data.frame(names, stats_dat)
str(top_colleges)
stats_dat$niche_grade <- gsub("Overall Niche Grade", "", stats_dat$niche_grade)
stats_dat$acceptance_rate <- as.numeric(gsub("[^0123456789,]", "", stats_dat$acceptance_rate)) / 100
stats_dat$net_price <- as.numeric(gsub("[^0123456789]", "", stats_dat$net_price))
stats_dat$SAT_range <- gsub("SAT Range", "", stats_dat$SAT_range)
head(stats_dat)
stats_dat$niche_grade <- gsub("Overall Niche Grade", "", stats_dat$niche_grade)
stats_dat$acceptance_rate <- as.numeric(gsub("[^0123456789,]", "", stats_dat$acceptance_rate))
# stats_dat$acceptance_rate <- as.numeric(gsub("[^0123456789,]", "", stats_dat$acceptance_rate)) / 100
stats_dat$net_price <- as.numeric(gsub("[^0123456789]", "", stats_dat$net_price))
stats_dat$SAT_range <- gsub("SAT Range", "", stats_dat$SAT_range)
head(stats_dat)
npages <- 10
colleges <- data.frame()
for(i in 1:npages) {
url <- paste0("https://www.niche.com/colleges/search/best-colleges/?page=",i, sep = "")
src <- read_html(url)
print(url)
nds <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result__title", " " ))]')
names <- html_text(nds)
nds2 <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-fact-list__item", " " ))]')
stats <- html_text(nds2)
stats_dat <- as.data.frame(matrix(stats, ncol = 4, byrow = T))
part <- data.frame(names, stats_dat)
colleges <- rbind(colleges, part)
}
top_colleges <- data.frame(names, stats_dat)
stats_dat <- as.data.frame(stats_dat)
names(stats_dat) <- c("niche_grade", "acceptance_rate", "net_price", "SAT_range")
stats_dat$niche_grade <- gsub("Overall Niche Grade", "", stats_dat$niche_grade)
stats_dat$acceptance_rate <- as.numeric(gsub("[^0123456789,]", "", stats_dat$acceptance_rate))
# stats_dat$acceptance_rate <- as.numeric(gsub("[^0123456789,]", "", stats_dat$acceptance_rate)) / 100
stats_dat$net_price <- as.numeric(gsub("[^0123456789]", "", stats_dat$net_price))
stats_dat$SAT_range <- gsub("SAT Range", "", stats_dat$SAT_range)
head(stats_dat)
top_colleges <- data.frame(names, stats_dat)
library(xml2)
library(rvest)
library(jsonlite)
library(robotstxt)
library(RSocrata)
paths_allowed("https://www.niche.com/colleges/search/best-colleges/")
paths_allowed("https://www.niche.com/colleges/search/best-colleges/")
url <- read_html("https://www.niche.com/colleges/search/best-colleges/")
nds <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "nss-i5xnri", " " ))]')
names <- html_text(nds)
head(names)
location_nodes <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-tagline__item", " " ))]')
locations <- html_text(location_nodes)
locations
nds2 <- html_nodes(url, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-fact-list__item", " " ))]')
stats <- html_text(nds2)
head(stats)
stats_dat <- matrix(stats, ncol = 4, byrow = T)
head(stats_dat)
stats_dat <- as.data.frame(stats_dat)
names(stats_dat) <- c("niche_grade", "acceptance_rate", "net_price", "SAT_range")
stats_dat$niche_grade <- gsub("Overall Niche Grade", "", stats_dat$niche_grade)
stats_dat$acceptance_rate <- as.numeric(gsub("[^0123456789,]", "", stats_dat$acceptance_rate))
# stats_dat$acceptance_rate <- as.numeric(gsub("[^0123456789,]", "", stats_dat$acceptance_rate)) / 100
stats_dat$net_price <- as.numeric(gsub("[^0123456789]", "", stats_dat$net_price))
stats_dat$SAT_range <- gsub("SAT Range", "", stats_dat$SAT_range)
head(stats_dat)
top_colleges <- data.frame(names, stats_dat)
str(top_colleges)
npages <- 10
colleges <- data.frame()
for(i in 1:npages) {
url <- paste0("https://www.niche.com/colleges/search/best-colleges/?page=",i, sep = "")
src <- read_html(url)
print(url)
nds <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result__title", " " ))]')
names <- html_text(nds)
nds2 <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-fact-list__item", " " ))]')
stats <- html_text(nds2)
stats_dat <- as.data.frame(matrix(stats, ncol = 4, byrow = T))
part <- data.frame(names, stats_dat)
colleges <- rbind(colleges, part)
}
str(colleges)
for(i in 1:npages) {
url <- paste0("https://www.niche.com/colleges/search/best-colleges/?page=",i, sep = "")
src <- read_html(url)
print(url)
nds <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result__title", " " ))]')
names <- html_text(nds)
nds2 <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-fact-list__item", " " ))]')
stats <- html_text(nds2)
stats_dat <- as.data.frame(matrix(stats, ncol = 4, byrow = T))
part <- data.frame(names, stats_dat)
colleges <- rbind(colleges, part)
}
for(i in 1:npages) {
url <- paste0("https://www.niche.com/colleges/search/best-colleges/?page=",i, sep = "")
src <- read_html(url)
print(url)
# 抓取学校名称
nds <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result__title", " " ))]')
names <- html_text(nds)
# 抓取学校统计数据
nds2 <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-fact-list__item", " " ))]')
stats <- html_text(nds2)
# 如果没有抓取到任何数据，跳过这次循环
if(length(names) == 0 | length(stats) == 0) {
print(paste("Skipping page", i, "due to no data"))
next
}
# 将统计数据转为数据框
stats_dat <- as.data.frame(matrix(stats, ncol = 4, byrow = T))
# 如果行数不匹配，跳过这次循环
if(nrow(stats_dat) != length(names)) {
print(paste("Skipping page", i, "due to mismatch in rows"))
next
}
# 合并数据
part <- data.frame(names, stats_dat)
# 添加到最终数据框
colleges <- rbind(colleges, part)
}
top_colleges$location(-c(4,5,6,8,9))
for(i in 1:npages) {
url <- paste0("https://www.niche.com/colleges/search/best-colleges/?page=",i, sep = "")
src <- read_html(url)
print(url)
nds <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result__title", " " ))]')
names <- html_text(nds)
nds2 <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-fact-list__item", " " ))]')
stats <- html_text(nds2)
stats_dat <- as.data.frame(matrix(stats, ncol = 4, byrow = T))
part <- data.frame(names, stats_dat)
colleges <- rbind(colleges, part)
}
for(i in 1:npages) {
url <- paste0("https://www.niche.com/colleges/search/best-colleges/?page=2",i, sep = "")
src <- read_html(url)
print(url)
nds <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result__title", " " ))]')
names <- html_text(nds)
nds2 <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-fact-list__item", " " ))]')
stats <- html_text(nds2)
stats_dat <- as.data.frame(matrix(stats, ncol = 4, byrow = T))
part <- data.frame(names, stats_dat)
colleges <- rbind(colleges, part)
}
top_colleges$location <- locations[-c(4,5,6,29,30,31)]
top_colleges$locations <- locations[-c(4,5,6,29,30,31)]
for(i in 1:npages) {
url <- paste0("https://www.niche.com/colleges/search/best-colleges/?page=2",i, sep = "")
src <- read_html(url)
print(url)
nds <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result__title", " " ))]')
names <- html_text(nds)
nds2 <- html_nodes(src, xpath = '//*[contains(concat( " ", @class, " " ), concat( " ", "search-result-fact-list__item", " " ))]')
stats <- html_text(nds2)
stats_dat <- as.data.frame(matrix(stats, ncol = 4, byrow = T))
part <- data.frame(names, stats_dat)
colleges <- rbind(colleges, part)
}
for(i in 1:npages) {
url <- paste0("https://www.niche.com/colleges/search/best-colleges/?page=2",i, sep = "")
src <- read_html(url)
print(url)
for(i in 1:npages) {
url <- paste0("https://www.niche.com/colleges/search/best-colleges/?page=2",i, sep = "")
src <- read_html(url)
print(url)
}
